<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Object with Three.js</title>
    <link rel="preload" as="fetch" href="./assets/Hyper-Scrypt-master/fonts/HyperScrypt.otf" fetchpriority="high">
    <link rel="stylesheet" type="text/css" href="assets/css.css">
    <link rel="preload" as="fetch" href="./assets/helmet/scene.gltf" fetchpriority="high">
    <link rel="preload" as="fetch" href="./assets/astronaut/scene.gltf" fetchpriority="high">
</head>

<body id="bod">

    <div id="landing">
        <p id="nico" style="opacity: 0;"></p>
    </div>

    <div id="loader">
        Loading...
        <br />
        <div id="loaded" style="font-size: 10px; color: gray;"></div>
        <progress id="file" max="100"></progress>
    </div>

    <div id="bfg" style="background: red; height: 100vh;"></div>

    <script src="https://cdn.jsdelivr.net/npm/three@latest/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@latest/examples/js/loaders/GLTFLoader.js"></script>
    <script>
        // DOM Elements
        const loaderElement = document.getElementById('loader');
        const progressBar = document.getElementById('file');
        const loaded = document.getElementById('loaded');
        const nicoElement = document.getElementById('nico');
        const bfgElement = document.getElementById('bfg');

        // Initialize variables
        let loadedModelsCount = 0;
        const totalModels = 1; // Update based on actual number of models

        // THREE.js Setup
        const scene2 = new THREE.Scene();
        const camera2 = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        const renderer2 = new THREE.WebGLRenderer();
        renderer2.setSize(window.innerWidth, window.innerHeight);
        bfgElement.appendChild(renderer2.domElement);

        // Handle window resizing
        window.addEventListener('resize', () => {
            camera2.aspect = window.innerWidth / window.innerHeight;
            camera2.updateProjectionMatrix();
            renderer2.setSize(window.innerWidth, window.innerHeight);
        });

        // Lighting
        const pointLight = new THREE.PointLight(0xff0000, 1, 100);
        pointLight.position.set(5, 5, 5);
        scene2.add(pointLight);

        // GLTF Loader
        const gltfLoader = new THREE.GLTFLoader();

        function loadModel(url, onLoad) {
            gltfLoader.load(
                url,
                (gltf) => {
                    scene2.add(gltf.scene);
                    onLoad(gltf.scene);
                    loadedModelsCount++;
                    updateLoadingProgress();
                },
                undefined,
                (error) => console.error(`Error loading model: ${url}`, error)
            );
        }

        function updateLoadingProgress() {
            const progress = (loadedModelsCount / totalModels) * 100;
            progressBar.value = Math.ceil(progress);
            loaded.textContent = `Loading: ${progress}%`;
            if (loadedModelsCount === totalModels) {
                setTimeout(() => {
                    loaderElement.style.display = 'none';
                    nicoElement.style.opacity = "1";
                    nicoElement.style.transition = "opacity 2s ease";
                }, 500);
            }
        }

        // Load models
        loadModel('./assets/bfg/scene.gltf', (model) => {
            model.position.set(1, 0, 0);
            console.log('Model loaded:', model);
        });

        // Set camera position
        camera2.position.z = 5;

        // Animation loop
        function animate2() {
            requestAnimationFrame(animate2);
            renderer2.render(scene2, camera2);
        }
        animate2();
    </script>
</body>

</html>